<div class="login-page">
  <div class="container">
    <div class="row">
      <div class="col-sm-6 col-sm-push-3">
        <% if flash[:notice] %>
            <h2 class="red-color"> <%= flash[:notice] %></h2>
        <% end %>
        <%= simple_form_for @micropost, class:"contact-form" do |m| %>
            <h2>修改内容</h2>

            <div class="form-group">
              <%= m.input :content, label: false, input_html: {class: 'form-control input-lg', rows: '8'} %>
            </div>
            <div class="form-group">
              <input id="micropost_stock_name" placeholder="输入股票代码" class="form-control input-lg" name="micropost[stock_name]">
              <input id="micropost_stock_id" type="hidden" name="micropost[stock_id]">
            </div>
            <div class="form-group">
              <% if @micropost.image.to_s!="" %>
                  <p><%= @micropost.image %></p>
              <% end %>
              <%= m.input :image, label: false %>
            </div>

            <div class="row">
              <div class="col-sm-6">
                <div class="form-group">
                  <%= m.submit "提交", class: 'form-control input-lg btn-success' %>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="form-group">
                  <%= link_back %>
                </div>
              </div>
            </div>

        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
    $(function () {
        $("#micropost_stock_name").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "/stock_json",
                    dataType: "json",
                    data: {
                        code: request.term,
                        maxRows: 10
                    },
                    success: function (data) {
                        response($.map(data, function (item) {
                            return {
                                label: item.code + ", " + item.name,
                                value: item.id

                            }
                        }));
                    }
                });
            },
            minLength: 1,
            select: function (event, ui) {
                $("#micropost_stock_name").val(ui.item.label);
                $("#micropost_stock_id").val(ui.item.value);
                return false;
            }
        });
    });
</script>
