<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gogu01</title>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
</head>
<body>
<header>

  <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <%= link_to "股刺网", root_page_path, class: "navbar-brand" %>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li><%= link_to "首页", root_page_path %></li>
          <% if signed_in? %>
              <li class="dropdown">
                <a href="" class="dropdown-toggle"
                   data-toggle="dropdown">信息<span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  <li><%= link_to "全部信息", user_path(current_user) %></li>
                  <li><%= link_to "热门信息", user_path(current_user) %></li>
                </ul>
              </li>
          <% else %>
              <li><%= link_to "全部信息", new_session_path %></li>
          <% end %>
        </ul>
        <% if signed_in? %>
            <%= simple_form_for Stock.new, url: show_stock_microposts_path, html: {class: "navbar-form navbar-left"} do |m| %>
                <div class="form-group">
                  <input id="stock_name" class="form-control"
                         type="text" placeholder="输入股票代码" name="stock[name]">
                  <input id="stock_id" name="stock[id]" type="hidden">
                </div>
                <button type="submit" class="btn btn-default">提交</button>
            <% end %>
        <% end %>
        <ul class="nav navbar-nav navbar-right">
          <% if signed_in? %>
              <li><%= link_to "新建信息", new_micropost_path %></li>
              <li> <%= link_to "我的信息", my_msg_users_path %></li>
              <% if @unread==true %>
                  <li><%= link_to "您有未读回复", unread_msg_users_path %></li>
              <% end %>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"> <%= current_user.name %>
                  <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  <li><%=link_to "修改密码",pre_update_passwd_users_path%></li>
                  <li><%=link_to "修改信息",pre_update_inform_users_path%></li>
                  <li class="divider"></li>
                  <li><%= link_to "退出", session_path(current_user), method: :delete %></li>
                </ul>
              </li>
          <% else %>
              <li><%= link_to "登录", new_session_path %></li>
          <% end %>
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
  </nav>
  <% if signed_in? %>
      <script>
          $(function () {

              $("#stock_name").autocomplete({
                  minLength: 1,
                  source: function (request, response) {
                      $.ajax({
                          url: "/stock_json",
                          dataType: "json",
                          data: {
                              code: request.term,
                              maxRows: 10
                          },
                          success: function (data) {
                              response($.map(data, function (item) {
                                  return {
                                      label: item.code + ", " + item.name,
                                      value: item.id

                                  }
                              }));
                          }
                      });
                  },

                  select: function (event, ui) {
                      $("#stock_name").val(ui.item.label);
                      $("#stock_id").val(ui.item.value);
                      return false;
                  }
              });
          });
      </script>
  <% end %>

</header>

<%= yield %>

<footer>
  <div class="container">
    <p class="copyright">
      ©2014 勾股定理 •
      提供最有价值的金融信息</a>
    </p>
  </div>
</footer>
</body>
</html>
